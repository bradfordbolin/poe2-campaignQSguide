<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brodfards POE2 Campaign Quickstart Guide</title>
  <meta name="description" content="Streamlined Path of Exile 2 Acts 1–4 + Interludes walkthrough for game version 0.4.0 with reward checklists, themes, and pre-endgame prep." />
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1621;
      --panel2:#121c2a;
      --text:#e6edf3;
      --muted:#a9b4c0;
      --border:#223046;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --bg-layer: radial-gradient(1200px 800px at 20% -10%, rgba(125,211,252,.20), transparent 55%),
                  radial-gradient(1100px 700px at 110% 0%, rgba(167,139,250,.18), transparent 50%);
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 12px;
      --space-lg: 18px;
      --wrap-y: 22px;
      --wrap-x: 18px;
      --wrap-bottom: 70px;
      --card-pad: 14px;
      --section-pad: 14px;
      --zone-pad: 12px;
      --btn-pad: 9px 12px;
      --control-gap: 10px;
      --control-radius: 999px;
      --font-size: 13px;
      --line-height:1.55;
      --header-blur: 10px;
    }
    [data-theme="poe-dark"]{}
    [data-theme="parchment"]{
      --bg: #f1e7d7;
      --panel: #fbf5e6;
      --panel2: #f5e8d1;
      --text: #2f2616;
      --muted: #6b5536;
      --border: #d5c1a3;
      --accent: #c47b27;
      --accent2: #9a5b18;
      --shadow: 0 8px 22px rgba(77,48,17,.18);
      --radius: 16px;
      --btn-pad: 10px 14px;
      --wrap-bottom: 80px;
      --bg-layer: radial-gradient(1200px 900px at 20% 10%, rgba(196,123,39,.18), transparent 50%),
                  radial-gradient(1000px 760px at 80% 10%, rgba(154,91,24,.12), transparent 60%);
    }
    [data-theme="oled"]{
      --bg:#000000;
      --panel:#050505;
      --panel2:#0a0a0a;
      --text:#f7f7f7;
      --muted:#9ca3af;
      --border:#1f2937;
      --accent:#22d3ee;
      --accent2:#a21caf;
      --shadow: 0 12px 28px rgba(0,0,0,.55);
    }
    [data-theme="high-contrast"]{
      --bg:#0b0b0b;
      --panel:#0f172a;
      --panel2:#111827;
      --text:#ffffff;
      --muted:#e2e8f0;
      --border:#fbbf24;
      --accent:#fbbf24;
      --accent2:#f97316;
      --radius: 10px;
      --shadow: 0 0 0 2px var(--border);
      --line-height:1.45;
    }
    [data-theme="speedrun"]{
      --space-sm: 6px;
      --space-md: 8px;
      --space-lg: 14px;
      --wrap-y: 18px;
      --wrap-x: 14px;
      --wrap-bottom: 46px;
      --card-pad: 10px;
      --section-pad: 10px;
      --zone-pad: 10px;
      --btn-pad: 7px 10px;
      --control-gap: 6px;
      --radius: 10px;
      --line-height:1.4;
      --font-size:12px;
    }
    [data-theme="mobile"]{
      --space-sm: 10px;
      --space-md: 14px;
      --space-lg: 22px;
      --wrap-y: 22px;
      --wrap-x: 14px;
      --wrap-bottom: 90px;
      --card-pad: 16px;
      --zone-pad: 14px;
      --btn-pad: 12px 16px;
      --control-gap: 12px;
      --radius: 16px;
      --line-height:1.6;
      --font-size:14px;
    }
    [data-theme="high-contrast-oled"]{
      --bg:#000000;
      --panel:#05060a;
      --panel2:#0a0c12;
      --text:#ffffff;
      --muted:#e2e8f0;
      --border:#fbbf24;
      --accent:#fbbf24;
      --accent2:#f97316;
      --radius: 10px;
      --shadow: 0 0 0 2px var(--border);
      --line-height:1.45;
    }
    [data-theme="speedrun-oled"]{
      --bg:#000000;
      --panel:#050505;
      --panel2:#0a0a0a;
      --text:#f7f7f7;
      --muted:#9ca3af;
      --border:#1f2937;
      --accent:#22d3ee;
      --accent2:#a21caf;
      --space-sm: 6px;
      --space-md: 8px;
      --space-lg: 14px;
      --wrap-y: 18px;
      --wrap-x: 14px;
      --wrap-bottom: 46px;
      --card-pad: 10px;
      --section-pad: 10px;
      --zone-pad: 10px;
      --btn-pad: 7px 10px;
      --control-gap: 6px;
      --radius: 10px;
      --line-height:1.4;
      --font-size:12px;
    }
    [data-theme="mobile-oled"]{
      --bg:#000000;
      --panel:#050505;
      --panel2:#0a0a0a;
      --text:#f7f7f7;
      --muted:#9ca3af;
      --border:#1f2937;
      --accent:#22d3ee;
      --accent2:#a21caf;
      --space-sm: 10px;
      --space-md: 14px;
      --space-lg: 22px;
      --wrap-y: 22px;
      --wrap-x: 14px;
      --wrap-bottom: 90px;
      --card-pad: 16px;
      --zone-pad: 14px;
      --btn-pad: 12px 16px;
      --control-gap: 12px;
      --radius: 16px;
      --line-height:1.6;
      --font-size:14px;
    }
    [data-theme="modern-oled"]{
      --bg:#020711;
      --panel:#050a14;
      --panel2:#020510;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border:#1f2937;
      --accent:#38bdf8;
      --accent2:#ec4899;
      --shadow: 0 16px 38px rgba(0,0,0,.45);
      --radius: 18px;
      --btn-pad:10px 14px;
    }
    [data-theme="matrix"]{
      --bg:#050807;
      --panel:#08100d;
      --panel2:#0b1612;
      --text:#c1f7d5;
      --muted:#5de093;
      --border:#0f2f1f;
      --accent:#22c55e;
      --accent2:#15803d;
      --shadow: 0 10px 30px rgba(4,12,9,.45);
      --bg-layer: linear-gradient(180deg, rgba(34,197,94,.06), transparent);
      --mono: "Share Tech Mono", var(--mono);
    }
    [data-theme="modern"]{
      --bg:#0f172a;
      --panel:#111827;
      --panel2:#0b1220;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border:#1f2937;
      --accent:#38bdf8;
      --accent2:#ec4899;
      --shadow: 0 16px 38px rgba(15,23,42,.35);
      --radius: 18px;
      --btn-pad:10px 14px;
    }
    [data-theme="nature"]{
      --bg:#0f2418;
      --panel:#113021;
      --panel2:#0d271a;
      --text:#e4f4e9;
      --muted:#9bd1b0;
      --border:#1f5136;
      --accent:#4ade80;
      --accent2:#22c55e;
      --bg-layer: radial-gradient(900px 900px at 10% 10%, rgba(34,197,94,.12), transparent 55%),
                  radial-gradient(800px 700px at 80% 10%, rgba(52,211,153,.08), transparent 60%);
    }
    [data-theme="water"]{
      --bg:#0a1b2a;
      --panel:#0f2638;
      --panel2:#0c1f2f;
      --text:#dcefff;
      --muted:#9ac7e3;
      --border:#1c3d5a;
      --accent:#38bdf8;
      --accent2:#22c55e;
      --bg-layer: radial-gradient(1000px 800px at 80% 0%, rgba(56,189,248,.20), transparent 60%),
                  radial-gradient(1200px 900px at 10% 20%, rgba(34,197,235,.10), transparent 70%);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background: var(--bg-layer), var(--bg);
      color:var(--text);
      line-height:var(--line-height);
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:var(--wrap-y) var(--wrap-x) var(--wrap-bottom)}
    header{
      position:sticky;top:0;z-index:20;
      backdrop-filter: blur(var(--header-blur));
      background: linear-gradient(90deg, color-mix(in srgb, var(--panel) 90%, transparent), color-mix(in srgb, var(--panel2) 90%, transparent));
      border-bottom:1px solid var(--border);
      box-shadow: 0 6px 24px rgba(0,0,0,.22);
    }
    .topbar{
      max-width:1100px;margin:0 auto;padding:var(--space-md) var(--wrap-x);
      display:flex;gap:var(--space-md);align-items:center;justify-content:space-between;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: var(--shadow);
    }
    .brand h1{font-size:19px;margin:0;letter-spacing:0.2px}
    .titleRow{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .titleMeta{display:flex;gap:6px;flex-wrap:wrap}
    .controls{display:flex;gap:var(--control-gap);align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .btn, .pill, input[type="search"]{
      border:1px solid var(--border);
      background: color-mix(in srgb, var(--panel) 92%, transparent);
      color:var(--text);
      border-radius:var(--control-radius);
      padding:var(--btn-pad);
      font-size:var(--font-size);
      box-shadow:none;
      outline:none;
    }
    .btn{cursor:pointer}
    .btn:hover{border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%)}
    input[type="search"]{min-width:260px}
    .pill{display:inline-flex;align-items:center;gap:8px}
    .kbd{
      font-family:var(--mono);font-size:12px;color:var(--muted);
      border:1px solid var(--border);border-bottom-width:2px;border-radius:8px;
      padding:1px 6px;background: color-mix(in srgb, var(--panel2) 88%, transparent);
    }
    .hero{
      margin-top:18px;
      display:grid;grid-template-columns: 1.2fr .8fr;gap:14px;
    }
    @media (max-width: 900px){ .hero{grid-template-columns:1fr} input[type="search"]{min-width:160px} }
    .card{
      background: linear-gradient(180deg, color-mix(in srgb, var(--panel) 92%, transparent), color-mix(in srgb, var(--panel2) 92%, transparent));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:var(--card-pad);
    }
    .subtle{color:var(--muted);font-size:13px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 700px){ .grid2{grid-template-columns:1fr} }
    .toc a{
      display:flex;justify-content:space-between;align-items:center;
      text-decoration:none;
      padding:8px 10px;border-radius:10px;
      border:1px solid transparent;
      color:var(--text);
    }
    .toc a:hover{border-color:var(--border);background: color-mix(in srgb, var(--panel2) 70%, transparent)}
    .tag{
      display:inline-flex;align-items:center;gap:6px;
      font-size:12px;padding:2px 10px;border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
      background: color-mix(in srgb, var(--panel2) 86%, transparent);
      white-space:nowrap;
    }
    .tag.good{color: color-mix(in srgb, var(--good) 85%, var(--text)); border-color: color-mix(in srgb, var(--good) 35%, var(--border));}
    .tag.warn{color: color-mix(in srgb, var(--warn) 85%, var(--text)); border-color: color-mix(in srgb, var(--warn) 35%, var(--border));}
    .tag.bad{color: color-mix(in srgb, var(--bad) 85%, var(--text)); border-color: color-mix(in srgb, var(--bad) 35%, var(--border));}
    .section{
      margin-top:16px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      overflow:hidden;
      background: color-mix(in srgb, var(--panel) 92%, transparent);
    }
    .section > summary{
      list-style:none;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      cursor:pointer;
      padding:var(--section-pad);
      background: color-mix(in srgb, var(--panel2) 76%, transparent);
      border-bottom:1px solid var(--border);
    }
    .section > summary::-webkit-details-marker{display:none}
    .sectTitle{
      display:flex;align-items:baseline;gap:10px;flex-wrap:wrap
    }
    .sectTitle strong{font-size:15px}
    .sectMeta{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .content{padding:var(--space-md) var(--section-pad) var(--section-pad)}
    .zone{
      border:1px solid var(--border);
      border-radius: 12px;
      padding:var(--zone-pad);
      background: color-mix(in srgb, var(--panel) 94%, transparent);
      margin-bottom:10px;
    }
    .zoneHeader{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-bottom:6px;
    }
    .zoneName{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;
      font-weight:700;
    }
    .zoneNum{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--border);
      border-radius:10px;
      padding:2px 8px;
      background: color-mix(in srgb, var(--panel2) 85%, transparent);
    }
    ul{margin:6px 0 0 18px;padding:0}
    li{margin:4px 0}
    .checks{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:8px
    }
    .check{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--border);
      border-radius:999px;
      padding:6px 10px;
      background: color-mix(in srgb, var(--panel2) 86%, transparent);
      font-size:12px;color:var(--muted);
      user-select:none;
    }
    .check input{accent-color: var(--accent); width:18px;height:18px}
    .note{
      margin-top:8px;
      border-left:3px solid var(--accent);
      padding:8px 10px;
      background: color-mix(in srgb, var(--panel2) 80%, transparent);
      border-radius:10px;
      color:var(--muted);
      font-size:13px;
    }
    .twoCols{
      display:grid;grid-template-columns:1fr 1fr;gap:10px
    }
    @media (max-width: 900px){ .twoCols{grid-template-columns:1fr} }
    .buildPanel{grid-column:1/-1;display:grid;gap:12px}
    .buildHeader{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:6px}
    .buildHeader h2{margin:0;font-size:17px}
    .buildBadges{display:flex;gap:8px;flex-wrap:wrap}
    .buildGrid{display:grid;grid-template-columns:1.3fr .7fr;gap:10px}
    @media(max-width: 900px){ .buildGrid{grid-template-columns:1fr} }
    .milestoneTable{width:100%;border-collapse:collapse;font-size:12px}
    .milestoneTable th,.milestoneTable td{border:1px solid var(--border);padding:6px 8px;vertical-align:top}
    .milestoneTable th{background:color-mix(in srgb,var(--panel2) 90%,transparent);text-align:left}
    .buildList{margin:6px 0 0 18px;padding:0}
    .buildList li{margin:4px 0}
    .buildChecks{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .buildChecks .check{width:100%;justify-content:space-between}
    @media(max-width: 700px){ .buildChecks .check{align-items:flex-start} }
    .buildNote{margin-top:6px;color:var(--muted);font-size:12px}
    .progressRow{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-top:8px
    }
    progress{width:280px;max-width:100%;height:12px}
    .muted{color:var(--muted)}
    .hidden{display:none!important}
    .faded{opacity:.35}
    .badge{display:inline-flex;align-items:center;gap:6px;font-size:11px;padding:4px 10px;border-radius:10px;border:1px solid var(--border);background:color-mix(in srgb,var(--panel2) 86%,transparent)}
    .legendRow{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .miniTimeline{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .miniTimeline button{border:1px solid var(--border);background:color-mix(in srgb,var(--panel2) 80%,transparent);color:var(--text);border-radius:8px;padding:4px 8px;font-size:11px;cursor:pointer}
    .difficulty{font-size:11px;color:var(--warn)}
    .reward-dashboard{max-height:70vh;overflow:auto;margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .rewardCard{border:1px solid var(--border);border-radius:12px;padding:10px;background:color-mix(in srgb,var(--panel2) 90%,transparent)}
    .rewardCard strong{display:block}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter: blur(6px);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
    .modal.active{display:flex}
    .modalContent{background:var(--panel);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);max-width:900px;width:100%;padding:16px}
    .modalHeader{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .noteInput{width:100%;min-height:64px;border-radius:12px;border:1px solid var(--border);background:color-mix(in srgb,var(--panel2) 90%,transparent);color:var(--text);padding:8px;font-family:var(--sans)}
    .bottomBar{position:sticky;bottom:0;z-index:25;background:color-mix(in srgb,var(--panel) 95%,transparent);border-top:1px solid var(--border);padding:10px 14px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center;backdrop-filter:blur(10px)}
    .bottomBar .btn{padding:10px 14px;font-weight:700}
    .stickyPad{padding-bottom:10px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .menu{position:relative}
    .menuPanel{position:absolute;right:0;top:calc(100% + 6px);background:color-mix(in srgb,var(--panel2) 96%,transparent);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:8px;display:none;flex-direction:column;gap:6px;min-width:180px;z-index:30}
    .menuPanel.show{display:flex}
    .menuItem{width:100%;text-align:left;justify-content:flex-start}
    .buildInline{border:1px dashed var(--border);border-radius:12px;padding:10px;margin:10px 0;display:none;flex-direction:column;gap:6px;background:color-mix(in srgb,var(--panel2) 80%,transparent)}
    .actMeter{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted)}
    .actMeter progress{width:180px}
    .callout{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)}
    .callout i{font-style:normal}
    .speedrun .note{display:none}
    .speedrun .zone{padding:10px 10px}
    .speedrun body{line-height:1.3}
    .speedrun .content{padding:8px 10px 10px}
    .highlight{outline:2px solid var(--accent);box-shadow:0 0 0 2px color-mix(in srgb,var(--accent) 40%, transparent);}
    .readonly input[type="checkbox"], .readonly textarea{pointer-events:none;opacity:.6}
    .dashFilter{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .dashFilter button{border:1px solid var(--border);background:color-mix(in srgb,var(--panel2) 82%,transparent);color:var(--text);border-radius:10px;padding:6px 10px;font-size:12px;cursor:pointer}
    .session-notes{margin-top:8px}
    .session-notes label{font-size:12px;color:var(--muted)}
    .animatedCheck{position:relative}
    .animatedCheck input:checked + span::after{content:"";position:absolute;inset:-4px;border-radius:999px;animation:pulse 0.5s ease-out}
    @keyframes pulse{from{box-shadow:0 0 0 0 rgba(125,211,252,.45);}to{box-shadow:0 0 0 12px rgba(125,211,252,0);}}
    @media (max-width: 700px){
      .controls{width:100%;justify-content:flex-start}
      .check{width:100%;justify-content:flex-start}
      .noteInput{min-height:90px}
      .zoneHeader{align-items:flex-start}
      .bottomBar{position:fixed;left:0;right:0}
      body{padding-bottom:90px}
    }
    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
    }
    @media print{
      header{position:static;backdrop-filter:none}
      body{background:#fff}
      :root,[data-theme]{
        --bg:#ffffff;--panel:#ffffff;--panel2:#ffffff;--text:#000;--muted:#333;--border:#ddd;
      }
      .btn,.pill,input[type="search"],.note{display:none!important}
      .section{break-inside:avoid}
      details{break-inside:avoid}
    }
  </style>
</head>
<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="titleRow">
          <h1>Brodfards POE2 Campaign Quickstart Guide</h1>
          <div class="titleMeta">
            <span class="tag">Acts 1–4 + Interludes</span>
            <span class="tag">Game v0.4.0</span>
            <span class="tag">League launch ready</span>
          </div>
        </div>
        <div class="subtle">Fast, reward-complete notes • pre-endgame prep • polished themes and mobile/Speedrun layouts</div>
      </div>
    </div>

    <div class="controls">
      <span class="pill" title="Search zones and rewards"><strong>Search</strong>&nbsp;<span class="kbd">/</span></span>
      <input id="q" type="search" placeholder="Type to filter (e.g., 'resistance', 'book', 'bench', 'ritual')…" autocomplete="off" />
      <select class="btn" id="themeSelect" title="Theme picker">
        <option value="poe-dark">PoE Dark</option>
        <option value="parchment">Parchment</option>
        <option value="oled">OLED</option>
        <option value="high-contrast">High Contrast</option>
        <option value="high-contrast-oled">High Contrast OLED</option>
        <option value="speedrun">Speedrun Compact</option>
        <option value="speedrun-oled">Speedrun OLED</option>
        <option value="mobile">Mobile Big Buttons</option>
        <option value="mobile-oled">Mobile OLED</option>
        <option value="matrix">Matrix</option>
        <option value="modern">Modern</option>
        <option value="modern-oled">Modern OLED</option>
        <option value="nature">Nature</option>
        <option value="water">Water</option>
      </select>
      <select class="btn" id="buildSelect" title="Build overlay">
        <option value="none">Build overlay: off</option>
        <option value="poisonburst-pathfinder">Poisonburst Arrow Pathfinder (League starter)</option>
      </select>
      <button class="btn" id="expandAll" type="button" title="Expand all acts">Expand</button>
      <button class="btn" id="collapseAll" type="button" title="Collapse all acts">Collapse</button>
      <button class="btn" id="reset" type="button" title="Clear all checkmarks & progress">Reset</button>
      <button class="btn" id="print" type="button" title="Print / Save as PDF">Print</button>
    </div>
  </div>
  <div style="border-top:1px solid var(--border);background:color-mix(in srgb,var(--panel) 90%,transparent);padding:10px 18px">
    <div class="topbar" style="padding:0;gap:10px">
      <div class="legendRow">
        <span class="badge" title="Latest content patch">Game v0.4.0</span>
        <span class="badge" title="Guide revision">Guide v1.2</span>
        <span class="badge" title="When this file was last touched">Updated for league start</span>
        <button class="btn" id="showChangelog" type="button">Guide changes</button>
        <a class="btn" href="https://www.pathofexile.com/forum/view-forum/2212" target="_blank" rel="noreferrer noopener">Game patch notes</a>
        <a class="btn" href="https://www.filterblade.xyz/" target="_blank" rel="noreferrer noopener">FilterBlade</a>
        <button class="btn" id="forkGuide" type="button">Fork this guide</button>
      </div>
      <div class="toolbar">
        <button class="btn" id="dashboard" type="button">Rewards-only dashboard</button>
        <button class="btn" id="dontMiss" type="button">Don’t miss mode</button>
        <button class="btn" id="speedrun" type="button">Speedrun mode</button>
        <div class="menu">
          <button class="btn" id="moreBtn" type="button" aria-expanded="false">More ▾</button>
          <div class="menuPanel" id="morePanel" role="menu">
            <button class="btn menuItem" id="shareLink" type="button">Share read-only link</button>
            <button class="btn menuItem" id="exportProgress" type="button">Export</button>
            <button class="btn menuItem" id="importProgress" type="button">Import</button>
          </div>
        </div>
        <select id="profileSelect" class="btn" title="Switch character profile" style="padding:9px 12px">
          <option value="starter">League Start</option>
          <option value="alt">Alt 1</option>
          <option value="hc">Alt 2</option>
        </select>
        <select id="language" class="btn" title="Language">
          <option value="en">English</option>
          <option value="es">Español</option>
        </select>
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="hero">
    <div class="card">
      <div class="twoCols">
        <div>
          <h2 style="margin:0 0 6px 0;font-size:16px">How to use while playing</h2>
          <div class="subtle">
            Keep this open on a second monitor. Check off each zone’s objectives as you complete them.
            Progress is saved automatically in your browser (local storage).
          </div>
          <div class="note">
            Tip: Use the search box to instantly filter to “Book of Specialisation”, “Permanent Buff”, “Bench”, “Uncut Skill Gem”, etc.
          </div>
        </div>
        <div>
          <h2 style="margin:0 0 6px 0;font-size:16px">Quick rewards legend</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">Permanent Buff</span>
            <span class="tag warn">Book / Points</span>
            <span class="tag">Gems</span>
            <span class="tag">Bench Unlock</span>
            <span class="tag">Currency / Loot</span>
            <span class="tag bad">Don’t Miss</span>
          </div>
          <div class="progressRow">
            <div>
              <div style="font-weight:700">Overall Progress</div>
              <div class="subtle"><span id="doneCount">0</span> / <span id="allCount">0</span> items checked</div>
            </div>
            <progress id="pbar" value="0" max="100"></progress>
          </div>
        </div>
      </div>
    </div>

    <div class="card toc">
      <h2 style="margin:0 0 8px 0;font-size:16px">Table of contents</h2>
      <a href="#act1"><span>Act 1 – Ogham Coast</span><span class="tag warn">14 zones</span></a>
      <a href="#act2"><span>Act 2 – Vastiri Desert</span><span class="tag warn">13 zones</span></a>
      <a href="#act3"><span>Act 3 – Jungles of Vastiri</span><span class="tag warn">11 zones</span></a>
      <a href="#act4"><span>Act 4 – Kingsmarch Islands</span><span class="tag warn">15 zones</span></a>
      <a href="#interludes"><span>Interludes (Holten, Khari, Doryani)</span><span class="tag warn">15 zones</span></a>
      <div class="note" style="margin-top:10px;border-left-color:var(--accent2)">
        Keyboard: press <span class="kbd">/</span> to focus search. Press <span class="kbd">Esc</span> to clear.
      </div>
    </div>

    <div class="card buildPanel" id="buildPanel">
      <div class="buildHeader">
        <div>
          <h2>Build-specific leveling overlay</h2>
          <div class="subtle">Select a build from the top bar to overlay leveling notes, rotations, and checklists alongside the act guide.</div>
        </div>
          <div class="buildBadges">
          <span class="tag">Multi-build ready</span>
          <span class="tag">Saved per profile</span>
          <span class="tag">Inline milestones</span>
        </div>
      </div>
      <div class="subtle">No build selected yet. Pick one in the top-right “Build overlay” dropdown to load tailored milestones and track build-only tasks.</div>
    </div>
  </div>

  <!-- ACT 1 -->
  <details class="section" id="act1">
    <summary>
      <div class="sectTitle">
        <strong>ACT 1 – Ogham Coast</strong>
        <span class="subtle">Reward-complete route</span>
      </div>
      <div class="sectMeta">
        <span class="tag good">Resists</span>
        <span class="tag warn">Books</span>
        <span class="tag">Gems</span>
        <span class="tag">Bench</span>
      </div>
      <div class="actMeter" data-act-meter="1"><progress value="0" max="100"></progress><span>Act completion</span></div>
      <div class="miniTimeline" data-timeline="1"></div>
    </summary>
    <div class="buildInline" data-build-inline="act1"></div>
    <div class="content">

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">1</span> Clearfell</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">+10% Cold Res</span>
            <span class="tag">Uncut Gems</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Locate the exit to <strong>The Grelwood</strong>.</li>
          <li><strong>North:</strong> Kill the boss for <strong>+10% Cold Resistance</strong> (Permanent Buff).</li>
          <li><strong>Mysterious Campsite:</strong> Chest for <strong>Lvl 1 Uncut Skill Gem</strong>.</li>
          <li><strong>Mud Burrow:</strong> Boss for <strong>Lvl 2 Uncut Skill Gem</strong> + <strong>Lvl 1 Uncut Support Gem</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z1-main">Exit found</label>
          <label class="check"><input type="checkbox" data-id="a1z1-coldres">+10% Cold Res</label>
          <label class="check"><input type="checkbox" data-id="a1z1-camp">Campsite chest</label>
          <label class="check"><input type="checkbox" data-id="a1z1-burrow">Mud Burrow boss</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">2</span> The Grelwood</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Uncut Gem</span>
            <span class="tag">Flasks</span>
          </div>
        </div>
        <ul>
          <li><strong>Layout:</strong> Diamond pattern. Visit all 4 points.</li>
          <li><strong>Brambleghast:</strong> Uncut Skill Gem <strong>(Level 2)</strong>.</li>
          <li><strong>Areagne’s Hut:</strong> <strong>Medium Life Flask</strong> + <strong>Medium Mana Flask</strong> + <strong>Uncut Support Gem (Level 1)</strong> (slay Areagne).</li>
          <li><strong>Main path:</strong> Locate <strong>Grim Tangle</strong> (enter first), <strong>Red Vale</strong>, and the <strong>Waypoint</strong> (Tree of Souls).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z2-4points">All 4 points</label>
          <label class="check"><input type="checkbox" data-id="a1z2-bramble">Brambleghast</label>
          <label class="check"><input type="checkbox" data-id="a1z2-hut">Areagne’s Hut</label>
          <label class="check"><input type="checkbox" data-id="a1z2-waypoint">Waypoint tagged</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">3</span> The Grim Tangle</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Support Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Route:</strong> Head in the exact opposite direction of where you entered.</li>
          <li><strong>Rotten Druid:</strong> Boss for <strong>Lvl 1 Uncut Support Gem</strong>.</li>
        </ul>
        <div class="note">Skip: when <strong>Una</strong> spawns, click her to start the song, then log out / respawn at checkpoint to skip the long animation.</div>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z3-boss">Rotten Druid</label>
          <label class="check"><input type="checkbox" data-id="a1z3-exit">Exit found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">4</span> The Red Vale</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Quest</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find 3 <strong>Rust Altars</strong> to complete the quest.</li>
          <li><strong>Route:</strong> Follow the outer edge in a loop; sometimes one altar is in the middle near the blood river.</li>
          <li><strong>Optional:</strong> <strong>Rust King</strong> drops an <strong>Uncut Skill Gem (Level 3)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z4-altars">3 Rust Altars</label>
          <label class="check"><input type="checkbox" data-id="a1z4-rustking">Rust King reward</label>
          <label class="check"><input type="checkbox" data-id="a1z4-exit">Exit found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">5</span> Cemetery of the Eternals</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Ring</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Locate <strong>Tomb of the Consort</strong> and <strong>Mausoleum of the Praetor</strong>.</li>
          <li><strong>Optional:</strong> Find the <strong>Ancient Ruin Sarcophagus</strong> for a <strong>Normal Ring</strong> (usually on far opposite wall).</li>
          <li><strong>Optional:</strong> <strong>Lachlann</strong> drops an <strong>Uncut Skill Gem (Level 3)</strong>.</li>
        </ul>
        <div class="note">Tip: One tomb often spawns along the same wall as the Lachlann boss arena.</div>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z5-tomb">Tomb found</label>
          <label class="check"><input type="checkbox" data-id="a1z5-maus">Mausoleum found</label>
          <label class="check"><input type="checkbox" data-id="a1z5-ring">Ring sarcophagus</label>
          <label class="check"><input type="checkbox" data-id="a1z5-lachlann">Lachlann reward</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">6</span> Mausoleum of the Praetor</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Quest</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Kill <strong>Draven</strong> (Sorrow Among Stones).</li>
          <li><strong>Route:</strong> Head to the quadrant opposite your entrance; look for a tile with a “ribbed” outer edge.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z6-draven">Draven dead</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">7</span> Tomb of the Consort</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Support Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Kill <strong>Asinia</strong> (Sorrow Among Stones).</li>
          <li><strong>Optional:</strong> Find <strong>Haunted Treasure</strong> (spawns a Rare Eternal Knight) for <strong>Lvl 1 Uncut Support Gem</strong>.</li>
          <li><strong>Route:</strong> Follow corridors through the center toward the top of the map.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z7-asinia">Asinia dead</label>
          <label class="check"><input type="checkbox" data-id="a1z7-treasure">Haunted Treasure</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">8</span> Hunting Grounds</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Book</span>
            <span class="tag">Lvl 4 Skill Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Layout:</strong> Key points in the 4 corners; avoid the middle unless doing the Ritual.</li>
          <li><strong>Crowbell:</strong> <strong>Book of Specialisation (+2 Weapon Set Skill Points)</strong>.</li>
          <li><strong>Dryadic Ritual (optional):</strong> <strong>Uncut Support Gem (Level 1)</strong>.</li>
          <li><strong>Ritual (middle):</strong> Complete for <strong>Lvl 4 Uncut Skill Gem</strong>.</li>
          <li><strong>Exits:</strong> Find entrances to <strong>Ogham Farmlands</strong> and <strong>Freythorn</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z8-book">Book of Specialisation</label>
          <label class="check"><input type="checkbox" data-id="a1z8-dryad">Dryadic Ritual</label>
          <label class="check"><input type="checkbox" data-id="a1z8-ritual">Ritual gem</label>
          <label class="check"><input type="checkbox" data-id="a1z8-exits">Both exits found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">9</span> Freythorn</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">+30 Spirit</span>
            <span class="tag">Spirit Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Complete 3 <strong>Ritual Encounters</strong>, then kill <strong>King of the Mist</strong>.</li>
          <li><strong>Reward:</strong> <strong>+30 Maximum Spirit</strong> + <strong>Uncut Spirit Gem</strong>.</li>
          <li><strong>Route:</strong> Loop the area. If you find boss arena first, the <strong>black magic swirls</strong> point toward missed Rituals.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z9-rituals">3 Rituals</label>
          <label class="check"><input type="checkbox" data-id="a1z9-boss">King of the Mist</label>
          <label class="check"><input type="checkbox" data-id="a1z9-reward">Spirit reward</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">10</span> Ogham Farmlands</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Book</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find <strong>Una's Hut</strong>.</li>
          <li><strong>Reward:</strong> Loot the Lute Box for <strong>Book of Specialisation</strong>.</li>
          <li><strong>Route:</strong> Opposite direction from entrance. Hut is hidden <em>behind</em> a long hut with carts blocking the direct path.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z10-hut">Una’s Hut</label>
          <label class="check"><input type="checkbox" data-id="a1z10-book">Book of Specialisation</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">11</span> Ogham Village</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Bench Unlock</span>
            <span class="tag">Quest</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Kill <strong>The Executioner</strong> (north).</li>
          <li><strong>Essential:</strong> Find <strong>Renly's Tools</strong> to unlock the <strong>Salvage Bench</strong>.</li>
          <li><strong>Optional:</strong> The room behind Renly’s Tools can include an <strong>Artificer’s Orb</strong> and a <strong>Blank Lesser Rune</strong>.</li>
          <li><strong>Route:</strong> Hug the <strong>right-hand wall</strong> and head north. Tools are in a room along this path (or slightly south if you hit the waypoint first).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z11-exec">Executioner</label>
          <label class="check"><input type="checkbox" data-id="a1z11-tools">Renly’s Tools (Salvage Bench)</label>
          <label class="check"><input type="checkbox" data-id="a1z11-orb">Room chest: Artificer’s Orb</label>
          <label class="check"><input type="checkbox" data-id="a1z11-rune">Room chest: Blank Lesser Rune</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">12</span> The Manor Ramparts</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Support Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Route:</strong> Follow the U-shape path.</li>
          <li><strong>Optional:</strong> Find the <strong>Gallows</strong> (hanging body) for <strong>Lvl 1 Uncut Support Gem</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z12-gallows">Gallows reward</label>
          <label class="check"><input type="checkbox" data-id="a1z12-exit">Exit found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">13</span> Ogham Manor (Floor 1)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">+20 Life</span>
          </div>
        </div>
        <ul>
          <li><strong>Route:</strong> Head northeast, cross the bridge, go north.</li>
          <li><strong>Candlemass:</strong> Boss for <strong>+20 to Maximum Life</strong> (Permanent Buff).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z13-candle">Candlemass (+20 Life)</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">14</span> Ogham Manor (Floors 2 & 3)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Final Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Floor 2:</strong> Head opposite your entrance to find stairs to Floor 3.</li>
          <li><strong>Floor 3:</strong> Cross the bridge to the <strong>Count of Ogham</strong> (Act 1 final boss).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a1z14-f2">Reached Floor 3</label>
          <label class="check"><input type="checkbox" data-id="a1z14-boss">Count of Ogham</label>
        </div>
      </div>

    </div>
  </details>

  <!-- ACT 2 -->
  <details class="section" id="act2">
    <summary>
      <div class="sectTitle">
        <strong>ACT 2 – Vastiri Desert</strong>
        <span class="subtle">3 core quests + key optional rewards</span>
      </div>
      <div class="sectMeta">
        <span class="tag bad">Ascendancy Unlock</span>
        <span class="tag good">Permanent Buff</span>
        <span class="tag warn">Books</span>
      </div>
      <div class="actMeter" data-act-meter="2"><progress value="0" max="100"></progress><span>Act completion</span></div>
      <div class="miniTimeline" data-timeline="2"></div>
    </summary>
    <div class="buildInline" data-build-inline="act2"></div>
    <div class="content">

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">1</span> Vastiri Outskirts</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Town</span>
            <span class="tag">Boss</span>
            <span class="tag">Skill Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Head to <strong>Ardura Caravan</strong> (town).</li>
          <li><strong>Rathbreaker:</strong> Kill on main path for quest progress and <strong>Uncut Skill Gem (Level 6)</strong> (quest reward).</li>
          <li><strong>Route:</strong> Linear—follow the main path.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z1-town">Reached town</label>
          <label class="check"><input type="checkbox" data-id="a2z1-boss">Rathbreaker</label>
          <label class="check"><input type="checkbox" data-id="a2z1-gem">Quest reward gem</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">2</span> Mawdun Quarry (Trail of Corruption)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Don’t Miss</span>
            <span class="tag">Artificer’s Orb</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Locate <strong>Mawdun Mine</strong> entrance.</li>
          <li><strong>Prison of the Disgraced:</strong> Look for <strong>Yellow Paper Seals</strong> on walls.</li>
          <li><strong>Bridge Cache:</strong> Beyond the bridge near a checkpoint sits a <strong>Faridun War Cache</strong> with an <strong>Artificer’s Orb</strong>.</li>
          <li><strong>Layout:</strong> S/Z-shape winding downward.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z2-prison">Found Prison</label>
          <label class="check"><input type="checkbox" data-id="a2z2-cache">Bridge Cache (Artificer’s Orb)</label>
          <label class="check"><input type="checkbox" data-id="a2z2-exit">Mine entrance</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">3</span> Mawdun Mine</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Uncut Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find the exit.</li>
          <li><strong>Munitions Bunker:</strong> Side area for <strong>Uncut Skill Gem</strong>.</li>
          <li><strong>Route:</strong> Keep to main tunnels and hug edges to spot the bunker.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z3-bunker">Munitions Bunker</label>
          <label class="check"><input type="checkbox" data-id="a2z3-exit">Exit found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">4</span> Traitor’s Passage</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Ascendancy Unlock</span>
            <span class="tag">Artificer’s Orb</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Push through to the opposite side of the passage.</li>
          <li><strong>Balbala:</strong> <strong>Djinn Barya</strong> (Ascendancy unlock — don’t miss).</li>
          <li><strong>Optional:</strong> <strong>Amber Cache</strong> can contain an <strong>Artificer’s Orb</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z4-balbala">Balbala (Djinn Barya)</label>
          <label class="check"><input type="checkbox" data-id="a2z4-cache">Amber Cache</label>
          <label class="check"><input type="checkbox" data-id="a2z4-exit">Passage exit</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">5</span> Mastodon Badlands</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Quest</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Enter <strong>The Bone Pits</strong>.</li>
          <li><strong>Route:</strong> Wide open—use edges to locate the entrance faster.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z5-bonepits">Bone Pits entrance</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">6</span> The Bone Pits</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Quest Item</span>
            <span class="tag">Support Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Clear the pits and collect the <strong>Mastodon Tusks</strong>.</li>
          <li><strong>Bosses:</strong> <strong>Iktab, the Deathlord</strong> and <strong>Ekbab, Ancient Steed</strong>.</li>
          <li><strong>Quest reward:</strong> <strong>Uncut Support Gem (Level 1)</strong>.</li>
          <li><strong>Route:</strong> Search for the large arena.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z6-iktab">Iktab defeated</label>
          <label class="check"><input type="checkbox" data-id="a2z6-boss">Ekbab dead</label>
          <label class="check"><input type="checkbox" data-id="a2z6-tusks">Tusks looted</label>
          <label class="check"><input type="checkbox" data-id="a2z6-support">Support gem reward</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">7</span> Keth (City of Seven Waters)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Book (+2 weapon points)</span>
            <span class="tag">Support Gem</span>
            <span class="tag">Resist Ring</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find <strong>The Venom Pit</strong> (often one of 4 corners).</li>
          <li><strong>Kabala/Kabadil:</strong> <strong>Book of Specialisation (+2 Weapon Set Skill Points)</strong>.</li>
          <li><strong>City of Seven Waters quest reward:</strong> <strong>Uncut Support Gem (Level 1)</strong>.</li>
          <li><strong>Elemental Offering:</strong> Choose a <strong>Fire/Cold/Lightning resistance ring</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z7-book">Book (+2 weapon)</label>
          <label class="check"><input type="checkbox" data-id="a2z7-support">Uncut Support Gem</label>
          <label class="check"><input type="checkbox" data-id="a2z7-ring">Resistance ring chosen</label>
          <label class="check"><input type="checkbox" data-id="a2z7-venompit">Venom Pit found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">8</span> The Lost City</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Spirit Gem</span>
            <span class="tag">Magic Jewel</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Locate <strong>The Buried Shrines</strong>.</li>
          <li><strong>Golden Tomb:</strong> Large golden sarcophagus for <strong>Uncut Spirit Gem</strong>.</li>
          <li><strong>Ninth Treasure of Keth:</strong> Kill the big bug unique enemy for a <strong>Magic Jewel</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z8-spirit">Golden Tomb (Spirit Gem)</label>
          <label class="check"><input type="checkbox" data-id="a2z8-jewel">Magic Jewel</label>
          <label class="check"><input type="checkbox" data-id="a2z8-shrines">Buried Shrines found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">9</span> Buried Shrines</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Support Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Pass through to next zone.</li>
          <li><strong>Suspicious Sarcophagus:</strong> Interact to spawn event. Reward: <strong>Uncut Support Gem</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z9-sarc">Suspicious Sarcophagus</label>
          <label class="check"><input type="checkbox" data-id="a2z9-exit">Exit</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">10</span> Valley of the Titans (A Crown of Stone)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">Permanent Buff</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Enter <strong>Titan Grotto</strong>.</li>
          <li><strong>Offering to Amrit:</strong> Place <strong>Kabala Clan Relic</strong> + <strong>Sun Clan Relic</strong> at the altar. Reward: <strong>Permanent Buff</strong> (choose <strong>+30% Charm Charges</strong> OR <strong>+15% Flask Life Recovery</strong>).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z10-relics">Relics placed (buff chosen)</label>
          <label class="check"><input type="checkbox" data-id="a2z10-grotto">Titan Grotto entered</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">11</span> Titan Grotto</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Seals</span>
            <span class="tag">Quest Item</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find 3 <strong>Ancient Seals</strong> to open the boss door.</li>
          <li><strong>Zalmarath:</strong> Quest reward: <strong>Uncut Support Gem (Level 1)</strong> + <strong>500 Gold</strong>.</li>
          <li><strong>Titan’s Sword:</strong> Loot for a <strong>Blank Lesser Rune</strong>.</li>
          <li><strong>Route:</strong> Run the outer edge; seals often sit near checkpoints.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z11-seals">3 Seals</label>
          <label class="check"><input type="checkbox" data-id="a2z11-boss">Zalmarath</label>
          <label class="check"><input type="checkbox" data-id="a2z11-gem">Support gem + gold</label>
          <label class="check"><input type="checkbox" data-id="a2z11-rune">Titan’s Sword rune</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">12</span> Deshar</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">+10% Lightning Res</span>
            <span class="tag warn">Book (+2 weapon)</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Push to the Spires of Deshar.</li>
          <li><strong>Sisters of Garukhan:</strong> Interact for <strong>+10% Lightning Resistance</strong> (Permanent Buff).</li>
          <li><strong>Fallen Rhoa Rider:</strong> <strong>Book of Specialisation (+2 Weapon Set Skill Points)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z12-lightres">+10% Lightning Res</label>
          <label class="check"><input type="checkbox" data-id="a2z12-book">Book (+2 weapon)</label>
          <label class="check"><input type="checkbox" data-id="a2z12-exit">Path to Spires</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">13</span> The Spires of Deshar (Finale)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Final Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Kill <strong>Tor Gul, the Defiler</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a2z13-boss">Tor Gul defeated</label>
        </div>
      </div>

    </div>
  </details>

  <!-- ACT 3 -->
  <details class="section" id="act3">
    <summary>
      <div class="sectTitle">
        <strong>ACT 3 – Jungles of Vastiri</strong>
        <span class="subtle">Key spirit, resist, ascendancy hooks</span>
      </div>
      <div class="sectMeta">
        <span class="tag good">Spirit</span>
        <span class="tag good">Fire Res</span>
        <span class="tag bad">Ascendancy (Trial item)</span>
      </div>
      <div class="actMeter" data-act-meter="3"><progress value="0" max="100"></progress><span>Act completion</span></div>
      <div class="miniTimeline" data-timeline="3"></div>
    </summary>
    <div class="buildInline" data-build-inline="act3"></div>
    <div class="content">

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">1</span> Sandswept Marsh</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Lesser Jeweller’s Orb</span>
            <span class="tag">Lvl 9 Skill Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find <strong>Ziggurat Encampment</strong> (town).</li>
          <li><strong>Azak Campfire:</strong> Huts with green leaves → chest for <strong>Lesser Jeweller’s Orb</strong>.</li>
          <li><strong>Foul Ritual:</strong> Kill <strong>Rootdredge</strong> for <strong>Uncut Skill Gem (Lvl 9)</strong>.</li>
          <li><strong>Hanging Tree:</strong> Click corpse for a <strong>Magic Ring</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z1-town">Reached town</label>
          <label class="check"><input type="checkbox" data-id="a3z1-jewel">Lesser Jeweller’s Orb</label>
          <label class="check"><input type="checkbox" data-id="a3z1-rootdredge">Rootdredge gem</label>
          <label class="check"><input type="checkbox" data-id="a3z1-ring">Hanging tree ring</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">2</span> Jungle Ruins</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Book (+2 points)</span>
            <span class="tag">Rare Belt</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find entrances to <strong>Venom Crypts</strong> and <strong>Infested Barrens</strong>.</li>
          <li><strong>Silverfist:</strong> Kill the large gorilla for <strong>Book of Specialisation (+2 Passive Points)</strong>.</li>
          <li><strong>Jungle Grave:</strong> Interactive object drops <strong>Rare Belt</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z2-book">Silverfist book</label>
          <label class="check"><input type="checkbox" data-id="a3z2-belt">Rare belt</label>
          <label class="check"><input type="checkbox" data-id="a3z2-exits">Both exits found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">3</span> Venom Crypts</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">Permanent Buff</span>
            <span class="tag">Artificer’s Orb</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Retrieve <strong>Corpse Snake Venom</strong>.</li>
          <li><strong>Turn-in:</strong> Return venom to <strong>Servi</strong> in town for a <strong>Permanent Buff</strong> (choose: <strong>Stun Threshold</strong>, <strong>Ailment Threshold</strong>, or <strong>Mana Regen</strong>) and an <strong>Artificer’s Orb</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z3-venom">Venom collected</label>
          <label class="check"><input type="checkbox" data-id="a3z3-buff">Buff chosen</label>
          <label class="check"><input type="checkbox" data-id="a3z3-orb">Artificer’s Orb</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">4</span> Infested Barrens</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Hub Zone</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Central hub connecting to <strong>Azak Bog</strong> and <strong>Chimeral Wetlands</strong>.</li>
          <li><strong>Route:</strong> Tag the waypoint and checkpoints to travel quickly between sub-zones.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z4-waypoint">Waypoint tagged</label>
          <label class="check"><input type="checkbox" data-id="a3z4-paths">Both paths found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">5</span> The Azak Bog</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">+30 Spirit</span>
            <span class="tag">Ritual</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Kill boss <strong>Ignagduk</strong>.</li>
          <li><strong>Reward:</strong> <strong>+30 Maximum Spirit</strong> (Permanent Buff).</li>
        </ul>
        <div class="note">Tip: Complete the <strong>Flameskin Ritual</strong> (light all fires) <em>before</em> the boss for a Fire Res buff that makes the fight easier.</div>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z5-ritual">Flameskin Ritual</label>
          <label class="check"><input type="checkbox" data-id="a3z5-boss">Ignagduk</label>
          <label class="check"><input type="checkbox" data-id="a3z5-spirit">+30 Spirit</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">6</span> Chimeral Wetlands</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Ascendancy Hook</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find <strong>Jiquani’s Machinarium</strong>.</li>
          <li><strong>Xyclucian:</strong> Boss drops <strong>Inscribed Ultimatum</strong> (Trial of Chaos unlock) and an <strong>Uncut Skill Gem (Level 9)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z6-ultimatum">Ultimatum acquired</label>
          <label class="check"><input type="checkbox" data-id="a3z6-machinarium">Machinarium found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">7</span> Jiquani’s Machinarium</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Route</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Pass through to <strong>Jiquani’s Sanctum</strong>.</li>
          <li><strong>Optional:</strong> Interact with <strong>Paquate’s Mechanism</strong> for loot.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z7-mechanism">Paquate’s Mechanism</label>
          <label class="check"><input type="checkbox" data-id="a3z7-exit">Reached Sanctum</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">8</span> Jiquani’s Sanctum</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">+10% Fire Res</span>
          </div>
        </div>
        <ul>
          <li><strong>Blackjaw:</strong> Kill for <strong>+10% Fire Resistance</strong> (Permanent Buff).</li>
          <li><strong>Optional:</strong> <strong>Grand Soul Core Nexus</strong> can award an <strong>Uncut Spirit Gem (Level 10)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z8-fire">+10% Fire Res</label>
          <label class="check"><input type="checkbox" data-id="a3z8-exit">Exit</label>
          <label class="check"><input type="checkbox" data-id="a3z8-soul">Grand Soul Core Nexus</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">9</span> The Matlan Waterways</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Route</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Follow <strong>Alva</strong> and locate <strong>The Drowned City</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z9-drowned">Drowned City found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">10</span> The Molten Vault (connected to Drowned City)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Bench Unlock</span>
            <span class="tag">Artificer’s Orb</span>
            <span class="tag">Skill Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Kill <strong>Mektul, the Forgemaster</strong>.</li>
          <li><strong>Rewards:</strong> Unlock <strong>Reforging Bench</strong> (sockets/links changes in town) + <strong>Artificer’s Orb</strong> + <strong>Uncut Skill Gem (Level 10)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z10-boss">Mektul dead</label>
          <label class="check"><input type="checkbox" data-id="a3z10-bench">Reforging Bench unlocked</label>
          <label class="check"><input type="checkbox" data-id="a3z10-orb">Artificer’s Orb</label>
          <label class="check"><input type="checkbox" data-id="a3z10-gem">Uncut Skill Gem (Lvl 10)</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">11</span> Apex of Filth → Utzaal & Aggorat (Finale)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Book (+2 points)</span>
            <span class="tag">Quality Flasks</span>
          </div>
        </div>
        <ul>
          <li><strong>Apex of Filth:</strong> Find the <strong>Cauldron Keeper</strong>; place mushrooms into cauldron. Reward: <strong>2× Quality Flasks</strong>.</li>
          <li><strong>Blood Sacrifice (Aggorat):</strong> Find <strong>Sacrificial Heart</strong> (from Vaal Goliaths) → place on altar. Reward: <strong>Book of Specialisation (+2 Passive Points)</strong>.</li>
          <li><strong>Finale:</strong> Reach <strong>Temple of Kopec</strong> and defeat the Act 3 boss.</li>
          <li><strong>Treasures of Utzaal:</strong> Optional extra currency/loot.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a3z11-flasks">2× Quality Flasks</label>
          <label class="check"><input type="checkbox" data-id="a3z11-heart">Sacrificial Heart</label>
          <label class="check"><input type="checkbox" data-id="a3z11-book">Book (+2 points)</label>
          <label class="check"><input type="checkbox" data-id="a3z11-boss">Act 3 boss</label>
          <label class="check"><input type="checkbox" data-id="a3z11-treasure">Treasures of Utzaal</label>
        </div>
      </div>

    </div>
  </details>

  <!-- ACT 4 -->
  <details class="section" id="act4">
    <summary>
      <div class="sectTitle">
        <strong>ACT 4 – Kingsmarch Islands (reward-complete)</strong>
        <span class="subtle">Non-linear island chain with weapon-set points and tattoos</span>
      </div>
      <div class="sectMeta">
        <span class="tag warn">Weapon Set Points</span>
        <span class="tag">Gems</span>
        <span class="tag good">Permanent Buff</span>
      </div>
      <div class="actMeter" data-act-meter="4"><progress value="0" max="100"></progress><span>Act completion</span></div>
      <div class="miniTimeline" data-timeline="4"></div>
    </summary>
    <div class="buildInline" data-build-inline="act4"></div>
    <div class="content">

      <div class="note" style="border-left-color:var(--accent2)"><strong>Suggested League Start 100% order:</strong> Kedge Bay + Journey’s End → Eye of Hinekora → Whakapanu → Singing Caverns → Shrike Island → Abandoned Prison → Solitary Confinement → Arastas → Ngakanu. Kingsmarch is non-linear; routes vary.</div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">1</span> Kingsmarch (Town)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Town</span>
            <span class="tag">Vendors</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Tag the town waypoint; trade, manage hideout, and use currency exchange here.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z1-town">Kingsmarch waypoint</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">2</span> Isle of Kin</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Support Gem</span>
            <span class="tag">Currency</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Explore for exits and side secrets.</li>
          <li><strong>Beast Pen:</strong> <strong>Uncut Support Gem (Level 4)</strong>.</li>
          <li><strong>Fossilised Formation:</strong> <strong>Lesser Jeweller’s Orb</strong>.</li>
          <li><strong>Flayed Sailor:</strong> <strong>Torn Map Piece</strong> (Forgotten Bounty).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z2-beast">Beast Pen</label>
          <label class="check"><input type="checkbox" data-id="a4z2-jewel">Lesser Jeweller’s Orb</label>
          <label class="check"><input type="checkbox" data-id="a4z2-map">Torn Map Piece</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">3</span> Volcanic Warrens</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag">Unlock</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Defeat <strong>Krutog</strong>; free <strong>Matiki</strong> to unlock <strong>Eye of Hinekora</strong> access.</li>
          <li><strong>Optional:</strong> <strong>Volcanic Nest</strong> (two rares) can drop Magic/Rare rings.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z3-krutog">Krutog</label>
          <label class="check"><input type="checkbox" data-id="a4z3-nest">Volcanic Nest</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">4</span> Kedge Bay</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Torn Map</span>
            <span class="tag">Currency</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Progress to <strong>Journey’s End</strong>.</li>
          <li><strong>Dead Man’s Chest:</strong> <strong>Torn Map Piece</strong>.</li>
          <li><strong>Abandoned Ship secret:</strong> <strong>Lesser Jeweller’s Orb</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z4-map">Dead Man’s Chest</label>
          <label class="check"><input type="checkbox" data-id="a4z4-ship">Abandoned Ship secret</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">5</span> Journey’s End</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Weapon Set Points</span>
            <span class="tag">Skill Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Defeat <strong>Captain Hartlin</strong> → get <strong>Verisium</strong> → free <strong>Freya</strong> via Karui Totems → defeat <strong>Omniphobia</strong>.</li>
          <li><strong>Reward:</strong> <strong>Uncut Skill Gem (Level 13)</strong> + <strong>+2 Weapon Set Skill Points</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z5-hartlin">Captain Hartlin</label>
          <label class="check"><input type="checkbox" data-id="a4z5-omniphobia">Omniphobia</label>
          <label class="check"><input type="checkbox" data-id="a4z5-reward">Gem + +2 weapon set points</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">6</span> Abandoned Prison</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Optional Buff</span>
            <span class="tag">Secret Room</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find <strong>Solitary Confinement</strong>.</li>
          <li><strong>Goddess of Justice (Chapel):</strong> Choose <strong>30% increased Life Recovery from Flasks</strong> OR <strong>30% increased Mana Recovery from Flasks</strong>.</li>
          <li><strong>Armoury secret room:</strong> Pull lever for extra loot.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z6-chapel">Goddess of Justice</label>
          <label class="check"><input type="checkbox" data-id="a4z6-secret">Armoury secret</label>
          <label class="check"><input type="checkbox" data-id="a4z6-exit">Solitary Confinement found</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">7</span> Solitary Confinement</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Defeat <strong>The Prisoner</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z7-boss">The Prisoner</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">8</span> Eye of Hinekora</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Trial Entry</span>
            <span class="tag good">Permanent Buff</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Complete the 3 tests to enter <strong>Halls of the Dead</strong>.</li>
          <li><strong>Optional:</strong> <strong>Silent Hall</strong> secret → <strong>+5% to Maximum Mana</strong> (permanent).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z8-tests">3 tests completed</label>
          <label class="check"><input type="checkbox" data-id="a4z8-mana">Silent Hall mana buff</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">9</span> Halls of the Dead</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Weapon Set Points</span>
            <span class="tag">Tattoos</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Defeat <strong>Yama the White</strong> → enter Trial → speak to Navali at top.</li>
          <li><strong>Rewards:</strong> <strong>Yama</strong>: +2 Weapon Set Skill Points; <strong>Navali</strong>: +2 Weapon Set Skill Points.</li>
          <li><strong>Optional:</strong> Tests award tattoos (blank tattoo exchange). <em>Warning: tattoos are permanent choices.</em></li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z9-yama">Yama defeated</label>
          <label class="check"><input type="checkbox" data-id="a4z9-navali">Navali reward</label>
          <label class="check"><input type="checkbox" data-id="a4z9-tattoos">Tattoo choices made</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">10</span> Whakapanu Island</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Support Gem</span>
            <span class="tag">Torn Map</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Find entrance to <strong>Singing Caverns</strong>.</li>
          <li><strong>Crabshell Cavern:</strong> <strong>Uncut Support Gem (Level 4)</strong>.</li>
          <li><strong>Petrified Pirate:</strong> <strong>Torn Map Piece</strong>.</li>
          <li><strong>Great White One (Sharkpit):</strong> Drops <strong>Shark Fin</strong>; turn in to <strong>Kaimana</strong> for choice of <strong>Uncut Skill Gem (Level 11)</strong> OR <strong>Uncut Spirit Gem (Level 11)</strong> OR <strong>Uncut Support Gem (Level 4)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z10-cavern">Crabshell Cavern</label>
          <label class="check"><input type="checkbox" data-id="a4z10-map">Petrified Pirate</label>
          <label class="check"><input type="checkbox" data-id="a4z10-shark">Great White One → reward chosen</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">11</span> Singing Caverns</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag">Amulet</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Defeat <strong>Diamora</strong>.</li>
          <li><strong>Optional:</strong> <strong>Beckoning Clam</strong> → <strong>Humming Pearl</strong> → turn in to <strong>Rog</strong> for a <strong>Rare Pearlescent Amulet</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z11-boss">Diamora</label>
          <label class="check"><input type="checkbox" data-id="a4z11-pearl">Humming Pearl → Amulet</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">12</span> Shrike Island</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag">Expedition Intro</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Defeat <strong>Scourge of the Skies</strong>.</li>
          <li><strong>Optional:</strong> <strong>Corpse Nest</strong> holds the 4th <strong>Torn Map Piece</strong>.</li>
          <li><strong>Forgotten Bounty:</strong> Return all 4 Torn Map Pieces to <strong>Makoru</strong> to unlock <strong>Plunder’s Point</strong> (Expedition intro).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z12-boss">Scourge of the Skies</label>
          <label class="check"><input type="checkbox" data-id="a4z12-map">Corpse Nest map piece</label>
          <label class="check"><input type="checkbox" data-id="a4z12-bounty">Forgotten Bounty turned in</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">13</span> Arastas</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Currency</span>
            <span class="tag">Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Reach <strong>The Excavation</strong>.</li>
          <li><strong>Morning Bell:</strong> <strong>3 Regal Orbs</strong>.</li>
          <li><strong>Evening Bell:</strong> <strong>3 Exalted Orbs</strong>.</li>
          <li><strong>Boss:</strong> <strong>Torvian, Hand of the Saviour</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z13-morning">Morning Bell</label>
          <label class="check"><input type="checkbox" data-id="a4z13-evening">Evening Bell</label>
          <label class="check"><input type="checkbox" data-id="a4z13-boss">Torvian</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">14</span> The Excavation</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Follow <strong>Tavakai/Makoru</strong> story beats and defeat <strong>Benedictus, First Herald of Utopia</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z14-boss">Benedictus</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">15</span> Ngakanu → Heart of the Tribe (Act 4 Finale)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Act Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Push through <strong>Ngakanu</strong> into <strong>Heart of the Tribe</strong>.</li>
          <li><strong>Boss:</strong> <strong>Tavakai, the Chieftain</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="a4z15-boss">Tavakai</label>
        </div>
      </div>

    </div>
  </details>

  <!-- INTERLUDES -->
  <details class="section" id="interludes">
    <summary>
      <div class="sectTitle">
        <strong>INTERLUDES (temporary story until Act 5)</strong>
        <span class="subtle">Three short chapters with weapon-set points and unique boons</span>
      </div>
      <div class="sectMeta">
        <span class="tag warn">Weapon Set Points</span>
        <span class="tag">Gems</span>
        <span class="tag good">Permanent Buff</span>
      </div>
    </summary>
    <div class="buildInline" data-build-inline="interludes"></div>
    <div class="content">

      <h3 style="margin:0 0 6px 0">INTERLUDE 1: Curse of Holten</h3>
      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">1</span> Holten (Town)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Town</span>
          </div>
        </div>
        <ul>
          <li><strong>Note:</strong> Ferryman can sell <strong>Greater Runes</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i1-town">Holten waypoint</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">2</span> Wolvenhold</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Weapon Set Points</span>
          </div>
        </div>
        <ul>
          <li><strong>Boss:</strong> <strong>Oswin</strong> → reward: <strong>+2 Weapon Set Skill Points</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i1-oswin">Oswin</label>
          <label class="check"><input type="checkbox" data-id="i1-points">+2 Weapon Set Points</label>
        </div>
      </div>

      <h3 style="margin:12px 0 6px 0">INTERLUDE 2: The Stolen Barya</h3>
      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">3</span> The Khari Bazaar (Town)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Town</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Prep for the crossing; tag nearby waypoints if available.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-bazaar">Bazaar waypoint</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">4</span> The Khari Crossing</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">Permanent Buff</span>
            <span class="tag warn">Weapon Set Points</span>
          </div>
        </div>
        <ul>
          <li><strong>Molten One’s Gift (Skullmaw Stairway):</strong> <strong>+5% increased maximum Life</strong>.</li>
          <li><strong>Bosses:</strong> <strong>Akthi + Anundr</strong> → talk to <strong>Risu</strong> in town for <strong>+2 Weapon Set Skill Points</strong>.</li>
          <li><strong>Tip:</strong> Tag waypoints to <strong>Pools of Khatal</strong> + <strong>Galai Gates</strong> early.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-life">Molten One’s Gift</label>
          <label class="check"><input type="checkbox" data-id="i2-bosses">Akthi + Anundr</label>
          <label class="check"><input type="checkbox" data-id="i2-points">+2 Weapon Set Points</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">5</span> Pools of Khatal → Sel Khari Sanctuary</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Route</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Traverse to <strong>Sel Khari Sanctuary</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-selkhari">Reached Sel Khari Sanctuary</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">6</span> Sel Khari Sanctuary</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag">Rare Gear</span>
          </div>
        </div>
        <ul>
          <li><strong>Boss:</strong> <strong>Elzarah</strong>.</li>
          <li><strong>Optional “Two Wishes” (Yoon’s/Rangeen’s Barya):</strong> Pick 2-of-3: <strong>Rare Ring</strong> / <strong>Rare Amulet</strong> / <strong>Rare Jewel</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-elzarah">Elzarah</label>
          <label class="check"><input type="checkbox" data-id="i2-wishes">Two Wishes reward</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">7</span> The Galai Gates</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
          </div>
        </div>
        <ul>
          <li><strong>Boss:</strong> <strong>Vornas</strong> → enter <strong>Qimah</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-vornas">Vornas</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">8</span> Qimah</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag good">Boon</span>
          </div>
        </div>
        <ul>
          <li><strong>Orbala’s Pillar:</strong> choose one boon (or <strong>Alima’s Disgrace</strong>). Options: <strong>12% CDR</strong>, <strong>20% Presence AoE</strong>, <strong>15% Global Defences</strong>, <strong>3% Move Speed</strong>, <strong>+5 all Attributes</strong>, <strong>+5% Ele Res</strong>, or <strong>Alima’s Disgrace</strong> (xp gain + downsides).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-boon">Boon chosen</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">9</span> Qimah Reservoir</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag">Currency</span>
          </div>
        </div>
        <ul>
          <li><strong>Boss:</strong> <strong>Azmadi</strong>.</li>
          <li><strong>Optional:</strong> <strong>Sacred Wells</strong> can be filled with Vials for guaranteed <strong>Exalted Orb</strong> + <strong>Orb of Alchemy</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i2-azmadi">Azmadi</label>
          <label class="check"><input type="checkbox" data-id="i2-wells">Sacred Wells filled</label>
        </div>
      </div>

      <h3 style="margin:12px 0 6px 0">INTERLUDE 3: Doryani’s Contingency</h3>
      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">10</span> The Glade (Town)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Town</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Tag the town waypoint.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i3-glade">Glade waypoint</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">11</span> Ashen Forest</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Skill Gem</span>
          </div>
        </div>
        <ul>
          <li><strong>Optional:</strong> <strong>Ancient Monument</strong> → <strong>Uncut Skill Gem (Level 14)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i3-monument">Ancient Monument</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">12</span> Kriar Village</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag warn">Weapon Set Points</span>
            <span class="tag">Spirit</span>
          </div>
        </div>
        <ul>
          <li><strong>Boss:</strong> <strong>Lythara</strong> → consume <strong>Gemcrust Skull</strong> for <strong>+40 Maximum Spirit</strong> + <strong>Uncut Spirit Gem (Level 14)</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i3-lythara">Lythara</label>
          <label class="check"><input type="checkbox" data-id="i3-spirit">Spirit reward</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">13</span> Glacial Tarn → Howling Caves</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag warn">Weapon Set Points</span>
          </div>
        </div>
        <ul>
          <li><strong>Objective:</strong> Clear to <strong>Howling Caves</strong> and defeat <strong>Abominable Yeti</strong> → return <strong>Icy Tusks</strong> to <strong>Hilda</strong> for <strong>+2 Weapon Set Skill Points</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i3-yeti">Abominable Yeti</label>
          <label class="check"><input type="checkbox" data-id="i3-tusks">Tusks turned in</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">14</span> Kriar Peaks</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Unique</span>
          </div>
        </div>
        <ul>
          <li><strong>Elder Madox:</strong> Pick <strong>1 free unique item</strong>.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i3-madox">Unique chosen</label>
        </div>
      </div>

      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">15</span> Etched Ravine → The Cuachic Vault</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Boss</span>
            <span class="tag warn">Weapon Set Points</span>
          </div>
        </div>
        <ul>
          <li><strong>Vault bosses:</strong> <strong>Zelina + Zolin</strong>.</li>
          <li><strong>After completion:</strong> Talk to <strong>Hooded One</strong> for <strong>+2 Weapon Set Skill Points</strong>; return to Act 4 then travel onward.</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="i3-vault">Zelina + Zolin</label>
          <label class="check"><input type="checkbox" data-id="i3-hooded">Hooded One reward</label>
        </div>
      </div>

    </div>
  </details>


  <!-- Endgame Prep -->
  <details class="section" id="endgame">
    <summary>
      <div class="sectTitle">
        <strong>BEFORE ENDGAME – League 0.4.0 Prep List</strong>
        <span class="subtle">Do this before mapping or campaign resets</span>
      </div>
      <div class="sectMeta">
        <span class="tag bad">Don’t Miss</span>
        <span class="tag">Bench</span>
        <span class="tag">Atlas</span>
      </div>
    </summary>
    <div class="buildInline" data-build-inline="endgame"></div>
    <div class="content">
      <div class="zone" data-zone>
        <div class="zoneHeader">
          <div class="zoneName"><span class="zoneNum">Prep</span> Endgame Readiness Checks</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag bad">Mandatory</span>
          </div>
        </div>
        <ul>
          <li>Spend all <strong>Books of Specialisation</strong> and check for unused passive points.</li>
          <li>Complete <strong>Ascendancy</strong> via <strong>Trial of the Sekhemas</strong> (Act 2) and <strong>Trial of Chaos</strong> (Act 3), then claim your Ascendancy in town.</li>
          <li>Bench unlocks: verify <strong>Flask, Socket Tuning, Conversion, Quality</strong> benches are active for crafting.</li>
          <li>Defensive caps: 75% elemental resists, 3–4 life flasks with bleed/freeze immunity, and at least one mobility flask.</li>
          <li>Gear swaps: weapon upgrades from Act 4 quality chest and a 4–5 link for main skill.</li>
          <li>Progression: buy missing <strong>map device portal scrolls</strong>, stock wisdom/portal scrolls, and stash an <strong>extra movement skill</strong>.</li>
          <li>Optional: run <strong>league mechanic tutorial node</strong> once for Atlas unlock credit (0.4.0).</li>
        </ul>
        <div class="checks">
          <label class="check"><input type="checkbox" data-id="prep-books">All books spent</label>
          <label class="check"><input type="checkbox" data-id="prep-ascend">Ascendancy taken</label>
          <label class="check"><input type="checkbox" data-id="prep-benches">Benches unlocked</label>
          <label class="check"><input type="checkbox" data-id="prep-resists">Resists & flasks ready</label>
          <label class="check"><input type="checkbox" data-id="prep-links">4–5 link equipped</label>
          <label class="check"><input type="checkbox" data-id="prep-maps">Map device ready</label>
          <label class="check"><input type="checkbox" data-id="prep-league">League tutorial cleared</label>
        </div>
      </div>
    </div>
  </details>

  <footer class="card">
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between">
      <div>
        <div style="font-weight:700;color:var(--text)">Offline-friendly</div>
        <div class="subtle">This file is self-contained. Save it anywhere and open it in your browser. Checkmarks persist per browser/device.</div>
      </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <span class="tag">v1.2</span>
          <span class="tag">Acts 1–4 + Interludes</span>
          <span class="tag">League 0.4.0 ready</span>
        </div>
    </div>
  </footer>
</div>

<div class="bottomBar stickyPad" aria-label="Quick actions">
  <button class="btn" id="toggleMobile">Mobile bar</button>
  <button class="btn" id="quickNext">Next unchecked</button>
  <button class="btn" id="toggleDonotMiss">Toggle Don’t Miss</button>
  <button class="btn" id="toggleBuilds">Build filters</button>
  <button class="btn" id="toggleTimeline">Timeline</button>
</div>

<div class="modal" id="modalDashboard" role="dialog" aria-modal="true">
  <div class="modalContent">
    <div class="modalHeader">
      <h3 style="margin:0">Rewards-only dashboard</h3>
      <button class="btn" data-close="modalDashboard">Close</button>
    </div>
    <div class="dashFilter">
      <button data-dash-filter="all">All</button>
      <button data-dash-filter="buff">Permanent buffs</button>
      <button data-dash-filter="book">Books</button>
    </div>
    <div class="reward-dashboard" id="rewardList"></div>
  </div>
</div>

<div class="modal" id="modalChangelog" role="dialog" aria-modal="true">
  <div class="modalContent">
    <div class="modalHeader">
      <h3 style="margin:0">Patch notes</h3>
      <button class="btn" data-close="modalChangelog">Close</button>
    </div>
    <ul>
      <li>Added build overlay selector with Poisonburst Arrow Pathfinder leveling table, rotation, and warnings.</li>
      <li>Added Act 4 walkthrough with new resist books, benches, and Kaom finale.</li>
      <li>Introduced OLED variants (High Contrast, Speedrun, Mobile, Modern) and refreshed header branding.</li>
      <li>Added league 0.4.0 pre-endgame checklist plus updated version badges.</li>
    </ul>
  </div>
</div>

<script>
(function(){
  const BASE_STORAGE_KEY = "poe2_walkthrough_checks_v1";
  const NOTES_KEY = "poe2_walkthrough_notes_v1";
  const THEME_KEY = "poe2_walkthrough_theme_v1";
  const PROFILE_KEY = "poe2_profile_sel";
  const BUILD_SELECT_KEY = "poe2_build_overlay_v1";
  const DEFAULT_THEME = "oled";
  const SUPPORTED_THEMES = [
    "poe-dark","parchment","oled","high-contrast","high-contrast-oled",
    "speedrun","speedrun-oled","mobile","mobile-oled","matrix","modern","modern-oled","nature","water"
  ];

  const builds = {
    none: { name: "None", tag: null },
    "poisonburst-pathfinder": {
      name: "Poisonburst Arrow Pathfinder",
      subtitle: "League starter • Bow / Chaos / Poison • Game v0.4.0",
      tag: "bow",
      highlights: ["Gas Arrow unlock @22", "+flat phys stacking", "Contagion → Herald of Plague swap"],
      checklist: [
        { id: "build-pba-flatphys", act: 1, label: "Act 1: Stack flat physical on gloves/rings/quiver + Warden bow at lvl 11", note: "Check vendors every 1–2 levels and never drop movement speed boots." },
        { id: "build-pba-conc", act: 1, label: "Link Concentrated Area to Poisonburst Arrow (first support) + Escalating Poison", note: "Huge single-target spike; keep it linked when possible." },
        { id: "build-pba-toxgrowth", act: 2, label: "Unlock Toxic Growth in Act 2 and keep Concentrated Area linked", note: "Major single-target upgrade that scales with Gas Arrow clouds." },
        { id: "build-pba-gasarrow", act: 2, label: "Level 22: buy Gas Arrow and practice Gas → Toxic Growth boss rotation", note: "Maintain clouds to proc Toxic Growth automatically." },
        { id: "build-pba-spirit-swap", act: 3, label: "Lvl ~26: swap Herald of Plague (clear) ⇄ Withering Presence (boss) as needed", note: "Boss swap adds ~20–25% damage." },
        { id: "build-pba-bow-upgrades", act: 4, label: "Use saved Iron Runes on lvl 39 Zealot or lvl 46 Artillery bow", note: "One good bow can last to campaign end." },
        { id: "build-pba-fire-warning", act: 2, label: "Avoid flat fire damage on gear until Persistent Ground II", note: "Ignites will pop Gas Arrow clouds and brick damage." }
      ],
      bossOrder: ["Devourer (for gems)", "Cold Witch", "Hut Witch", "Rust King"],
      milestones: [
        { act: 1, level: "Lvl 1-6", area: "Start", gear: "Stack flat phys on gloves/rings/quiver; movement speed boots", skills: "Lightning Arrow + Contagion", note: "Flat phys is a massive Act 1 spike." },
        { act: 1, level: "Lvl 6", area: "Ranger – Fate of the Vaal", gear: "Keep vendor-checking every 1–2 levels", skills: "Ascendancy: Overwhelming Toxicity (when available)", note: "Act 1 boss order: Devourer > Cold Witch > Hut Witch > Rust King" },
        { act: 1, level: "Lvl 7-13", area: "Act 1", gear: "Lvl 11 Warden Bow (prefer %phys)", skills: "Support 1: Concentrated Area; Support 2: Escalating Poison", note: "Passive tree: rush Crippling Toxins, Clean Shot, Vile Wounds." },
        { act: 2, level: "Lvl 14-21", area: "Act 2", gear: "Broadhead Quiver", skills: "Unlock Toxic Growth; keep Concentrated Area linked", note: "Use Contagion to spread poison until Herald of Plague." },
        { act: 3, level: "Lvl 22-28", area: "Act 2 / Act 3", gear: "Keep flat phys, life, resists", skills: "Lvl 22 Gas Arrow; swap Herald of Plague in for clear", note: "Avoid flat fire damage until Persistent Ground II." },
        { act: 3, level: "Lvl 29-38", area: "Act 3 / Act 4", gear: "Recurve Bow upgrade", skills: "Maximise support links", note: "Damage becomes extremely good here." },
        { act: 4, level: "Lvl 39-53", area: "Act 4 / Act 5", gear: "Zealot (39) or Artillery (46) bow", skills: "Add Honed Instincts + Magnified Area I", note: "Bow can last to end of campaign." }
      ],
      clearing: [
        "Lvl 1-26: Poisonburst Arrow once, then Contagion to spread poison (acts like poison prolif).",
        "Lvl 26+: Drop Contagion; use Poisonburst Arrow + Gas Arrow after Herald of Plague is online."
      ],
      bossRotation: [
        "Place Vine Arrow on boss for free damage.",
        "Use Gas Arrow 1-2x to seed clouds (procs Toxic Growth).",
        "Spam Toxic Growth while refreshing Gas Arrow when it expires."
      ],
      tips: [
        "Damage scales purely from flat physical; elemental scaling is negligible.",
        "Vendor-check rings/gloves/quiver/bow every 1–2 levels for flat phys upgrades.",
        "Always salvage quality weapons for Whetstones and socketed items for Artificer's Orbs.",
        "Never drop movement speed boots unless the new pair also has movement speed.",
        "For bossing, swap Herald of Plague to Withering Presence for a 20–25% single-target bump."
      ],
      warnings: [
        "Avoid flat fire damage until you have Persistent Ground II for Gas Arrow (prevents cloud pops).",
        "Maintain Concentrated Area on Poisonburst/Toxic Growth for bosses—30% more damage from support." 
      ]
    }
  };

  const q = document.getElementById("q");
  const themeSelect = document.getElementById("themeSelect");
  const btnExpand = document.getElementById("expandAll");
  const btnCollapse = document.getElementById("collapseAll");
  const btnReset = document.getElementById("reset");
  const btnPrint = document.getElementById("print");
  const btnDashboard = document.getElementById("dashboard");
  const btnDontMiss = document.getElementById("dontMiss");
  const btnSpeedrun = document.getElementById("speedrun");
  const btnExport = document.getElementById("exportProgress");
  const btnImport = document.getElementById("importProgress");
  const btnShare = document.getElementById("shareLink");
  const btnMore = document.getElementById("moreBtn");
  const morePanel = document.getElementById("morePanel");
  const btnFork = document.getElementById("forkGuide");
  const btnShowChangelog = document.getElementById("showChangelog");
  const btnQuickNext = document.getElementById("quickNext");
  const btnTimelineToggle = document.getElementById("toggleTimeline");
  const btnBuildToggle = document.getElementById("toggleBuilds");
  const btnDontMissBottom = document.getElementById("toggleDonotMiss");
  const profileSelect = document.getElementById("profileSelect");
  const languageSelect = document.getElementById("language");
  const doneCount = document.getElementById("doneCount");
  const allCount = document.getElementById("allCount");
  const pbar = document.getElementById("pbar");
  const rewardList = document.getElementById("rewardList");
  const modalDashboard = document.getElementById("modalDashboard");
  const modalChangelog = document.getElementById("modalChangelog");

  let checkboxes = [];
  const wiredCheckboxes = new Set();
  const zones = Array.from(document.querySelectorAll("[data-zone]"));
  const acts = Array.from(document.querySelectorAll("details.section"));
  const buildPanel = document.getElementById("buildPanel");
  const buildSelect = document.getElementById("buildSelect");
  let currentProfile = localStorage.getItem(PROFILE_KEY) || "starter";
  let readOnlyShare = false;
  let dontMissActive = false;

  // Utilities
  const normalize = (s)=> (s||"").toLowerCase().trim();
  const storageKey = ()=> `${BASE_STORAGE_KEY}_${currentProfile}`;
  const noteKey = ()=> `${NOTES_KEY}_${currentProfile}`;
  const buildKey = ()=> `${BUILD_SELECT_KEY}_${currentProfile}`;

  function loadChecks(){
    try{
      const raw = localStorage.getItem(storageKey());
      if(!raw) return {};
      return JSON.parse(raw) || {};
    }catch(e){ return {}; }
  }
  function saveChecks(map){ if(readOnlyShare) return; try{ localStorage.setItem(storageKey(), JSON.stringify(map)); }catch(e){} }
  function loadNotes(){ try{ return JSON.parse(localStorage.getItem(noteKey())||"{}") || {}; }catch(e){ return {}; } }
  function saveNotes(map){ if(readOnlyShare) return; try{ localStorage.setItem(noteKey(), JSON.stringify(map)); }catch(e){} }

  function syncCheckboxes(){
    checkboxes = Array.from(document.querySelectorAll('input[type="checkbox"][data-id]'));
  }

  function resolveThemeName(name){
    if(!name) return DEFAULT_THEME;
    return SUPPORTED_THEMES.includes(name) ? name : DEFAULT_THEME;
  }
  function applyTheme(name){
    const theme = resolveThemeName(name || localStorage.getItem(THEME_KEY));
    document.documentElement.setAttribute("data-theme", theme);
    if(themeSelect){ themeSelect.value = theme; }
    localStorage.setItem(THEME_KEY, theme);
  }

  function recomputeProgress(){
    const total = checkboxes.length;
    const done = checkboxes.filter(c => c.checked).length;
    allCount.textContent = total;
    doneCount.textContent = done;
    const pct = total ? Math.round((done/total)*100) : 0;
    pbar.value = pct;
    pbar.max = 100;

    acts.forEach((act, idx)=>{
      const actCbs = Array.from(act.querySelectorAll('input[type="checkbox"][data-id]'));
      const actDone = actCbs.filter(c=>c.checked).length;
      const meter = act.querySelector(`[data-act-meter="${idx+1}"] progress`);
      if(meter){
        meter.max = actCbs.length || 1;
        meter.value = actDone;
      }
      const title = act.querySelector('.sectTitle strong');
      if(title){ title.textContent = title.textContent.replace(/ \(Complete\)$/,'') + (actDone === actCbs.length && actCbs.length ? ' (Complete)' : ''); }
    });
  }

  function rewardTypeFromText(text){
    const t = normalize(text);
    if(/book|passive|specialisation/.test(t)) return "book";
    if(/permanent buff|\+\d+%|spirit|res|boon|choice/.test(t)) return "buff";
    return "misc";
  }

  function buildTags(text){
    const t = normalize(text);
    const tags = [];
    if(/weapon|smith|strike|melee|axe|sword|club/.test(t)) tags.push("melee");
    if(/spell|ritual|orb|mana|totem|staff|wand/.test(t)) tags.push("caster");
    if(/minion|spirit|summon|totem/.test(t)) tags.push("minion");
    if(/bow|arrow|quiver|ranger/.test(t)) tags.push("bow");
    return tags.length ? tags : ["all"];
  }

  function renderBuildOverlay(buildId){
    if(!buildPanel || !buildSelect) return;
    const data = builds[buildId] || builds.none;
    localStorage.setItem(buildKey(), buildId);
    buildSelect.value = buildId;
    buildPanel.innerHTML = "";

    const header = document.createElement("div");
    header.className = "buildHeader";
    header.innerHTML = `
      <div>
        <h2>${data.name || "Build overlay"}</h2>
        <div class="subtle">${data.subtitle || "Choose a build to layer in leveling steps, rotations, and warnings."}</div>
      </div>
      <div class="buildBadges">
        ${data.tag ? `<span class="tag">${data.tag.charAt(0).toUpperCase()+data.tag.slice(1)}</span>` : ''}
        ${data.highlights ? data.highlights.map(h=>`<span class="tag">${h}</span>`).join("") : ''}
      </div>
    `;
    buildPanel.appendChild(header);

    if(!data || buildId === "none"){
      const empty = document.createElement("div");
      empty.className = "subtle";
      empty.textContent = "Pick a build from the top bar to load milestones and build-only checklists.";
      buildPanel.appendChild(empty);
      renderBuildInlineSteps("none");
      applyBuildFilter(null);
      syncCheckboxes();
      recomputeProgress();
      return;
    }

    const grid = document.createElement("div");
    grid.className = "buildGrid";

    const left = document.createElement("div");
    const inlineNote = document.createElement("div");
    inlineNote.className = "note";
    inlineNote.textContent = "Build milestones and setup steps now appear inline inside each Act section below.";
    left.appendChild(inlineNote);

    const rotation = document.createElement("div");
    rotation.innerHTML = `
      <h3 style="margin:12px 0 6px 0">How to play</h3>
      <div><strong>Clearing</strong><ul class="buildList">${(data.clearing||[]).map(item=>`<li>${item}</li>`).join("")}</ul></div>
      <div style="margin-top:6px"><strong>Boss / rare rotation</strong><ul class="buildList">${(data.bossRotation||[]).map(item=>`<li>${item}</li>`).join("")}</ul></div>
    `;
    left.appendChild(rotation);

    const right = document.createElement("div");
    if(data.bossOrder){
      const boss = document.createElement("div");
      boss.className = "buildNote";
      boss.innerHTML = `<strong>Act 1 boss order:</strong> ${data.bossOrder.join(" → ")}`;
      right.appendChild(boss);
    }

    if(data.tips?.length){
      const tips = document.createElement("div");
      tips.innerHTML = `<h3 style="margin:0 0 6px 0">Key tips</h3><ul class="buildList">${data.tips.map(t=>`<li>${t}</li>`).join("")}</ul>`;
      right.appendChild(tips);
    }

    if(data.warnings?.length){
      const warn = document.createElement("div");
      warn.innerHTML = `<h3 style="margin:12px 0 6px 0">Warnings</h3><ul class="buildList">${data.warnings.map(t=>`<li>${t}</li>`).join("")}</ul>`;
      right.appendChild(warn);
    }

    grid.appendChild(left);
    grid.appendChild(right);
    buildPanel.appendChild(grid);

    renderBuildInlineSteps(buildId);
    applyBuildFilter(data.tag);
    initChecks();
  }

  function attachNotes(){
    const notes = loadNotes();
    zones.forEach((zone, idx)=>{
      const zId = zone.dataset.zoneId || `zone-${idx+1}`;
      zone.dataset.zoneId = zId;
      zone.querySelectorAll('.session-notes').forEach(n=>n.remove());
      const wrapper = document.createElement("div");
      wrapper.className = "session-notes";
      const label = document.createElement("label");
      label.textContent = "Session notes (saved per profile)";
      const textarea = document.createElement("textarea");
      textarea.className = "noteInput";
      textarea.value = notes[zId] || "";
      textarea.addEventListener("input", () => {
        const cur = loadNotes();
        cur[zId] = textarea.value;
        saveNotes(cur);
      });
      if(readOnlyShare){ textarea.setAttribute("disabled", true); }
      wrapper.appendChild(label);
      wrapper.appendChild(textarea);
      zone.appendChild(wrapper);
    });
  }

  function initChecks(){
    const map = loadChecks();
    syncCheckboxes();
    for(const cb of checkboxes){
      cb.checked = !!map[cb.dataset.id];
      cb.parentElement.classList.add("animatedCheck");
      if(!wiredCheckboxes.has(cb.dataset.id)){
        cb.addEventListener("change", () => {
          const current = loadChecks();
          current[cb.dataset.id] = cb.checked;
          saveChecks(current);
          recomputeProgress();
        });
        wiredCheckboxes.add(cb.dataset.id);
      }
      if(readOnlyShare){ cb.setAttribute("disabled", true); }
    }
    recomputeProgress();
  }

  function filter(){
    const term = normalize(q.value);
    if(!term){
      for(const z of zones){ z.classList.remove("hidden"); }
      return;
    }
    for(const z of zones){
      const txt = normalize(z.innerText);
      z.classList.toggle("hidden", !txt.includes(term));
    }
  }

  function expandAll(){ for(const a of acts){ a.open = true; } }
  function collapseAll(){ for(const a of acts){ a.open = false; } }

  function resetAll(){
    if(!confirm("Reset all checkmarks and progress?")) return;
    localStorage.removeItem(storageKey());
    for(const cb of checkboxes){ cb.checked = false; }
    recomputeProgress();
  }

  function createTimeline(){
    acts.forEach((act, idx)=>{
      const timeline = act.querySelector(`[data-timeline="${idx+1}"]`);
      if(!timeline) return;
      timeline.innerHTML = "";
      act.querySelectorAll(".zoneName").forEach((zName)=>{
        const btn = document.createElement("button");
        btn.textContent = zName.textContent.trim();
        btn.addEventListener("click", ()=> zName.scrollIntoView({behavior:"smooth",block:"start"}));
        timeline.appendChild(btn);
      });
    });
  }

  function rewardHowTo(zone, rewardText){
    const noteItems = Array.from(zone.querySelectorAll(".notes li"));
    const allItems = noteItems.length ? noteItems : Array.from(zone.querySelectorAll("ul li"));
    if(!allItems.length) return "";
    const target = normalize(rewardText);
    const match = allItems.find(li=>{
      const txt = normalize(li.textContent);
      return target.split(/\s+/).some(word => word.length > 3 && txt.includes(word));
    }) || allItems.find(li=> /objective|boss|kill|reward|book|buff|chest|quest/i.test(li.textContent)) || allItems[0];
    return match ? match.textContent.trim() : "";
  }

  function renderRewards(filterType="all"){
    rewardList.innerHTML = "";
    const items = [];
    zones.forEach((zone)=>{
      const zoneTitle = zone.querySelector(".zoneName")?.textContent?.trim() || "Zone";
      const rewardLabels = Array.from(zone.querySelectorAll(".checks label"));
      rewardLabels.forEach((label)=>{
        const type = rewardTypeFromText(label.innerText);
        if(type === "misc") return;
        items.push({
          type,
          zone: zoneTitle,
          text: label.innerText.trim(),
          checkbox: label.querySelector('input'),
          how: rewardHowTo(zone, label.innerText)
        });
      });
    });
    items.filter(item => filterType === "all" || item.type === filterType)
      .forEach((item)=>{
        const card = document.createElement("div");
        card.className = "rewardCard";
        const badge = document.createElement("span");
        badge.className = `tag ${item.type === "buff" ? "good" : item.type === "book" ? "warn" : ""}`;
        badge.textContent = item.type;
        const title = document.createElement("strong");
        title.textContent = item.text;
        const meta = document.createElement("div");
        meta.className = "subtle";
        meta.textContent = item.zone;
        const how = document.createElement("div");
        how.className = "subtle";
        how.textContent = item.how ? `How: ${item.how}` : "";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = item.checkbox.checked;
        cb.addEventListener("change", ()=>{
          item.checkbox.checked = cb.checked;
          item.checkbox.dispatchEvent(new Event("change"));
        });
        const label = document.createElement("label");
        label.style.display = "flex";
        label.style.alignItems = "center";
        label.style.gap = "8px";
        label.appendChild(cb);
        label.appendChild(title);
        card.appendChild(badge);
        card.appendChild(label);
        card.appendChild(meta);
        if(how.textContent){ card.appendChild(how); }
        rewardList.appendChild(card);
    });
  }

  function toggleModal(el, show){
    if(show){ el.classList.add("active"); }
    else{ el.classList.remove("active"); }
  }

  function dontMissMode(force){
    if(force === true) dontMissActive = true;
    else if(force === false) dontMissActive = false;
    else dontMissActive = !dontMissActive;
    zones.forEach((z)=>{
      const important = /permanent buff|book|bench|ascend|spirit|resist/i.test(z.innerText);
      z.classList.toggle("hidden", dontMissActive && !important);
    });
  }

  function toggleMoreMenu(show){
    if(!btnMore || !morePanel) return;
    const next = typeof show === "boolean" ? show : !morePanel.classList.contains("show");
    morePanel.classList.toggle("show", next);
    btnMore.setAttribute("aria-expanded", next ? "true" : "false");
  }

  function initMoreMenu(){
    if(!btnMore || !morePanel) return;
    btnMore.addEventListener("click", (e)=>{ e.stopPropagation(); toggleMoreMenu(); });
    document.addEventListener("click", (e)=>{
      if(!morePanel.classList.contains("show")) return;
      if(!morePanel.contains(e.target) && e.target !== btnMore){ toggleMoreMenu(false); }
    });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") toggleMoreMenu(false); });
  }

  function renderBuildInlineSteps(buildId){
    const containers = Array.from(document.querySelectorAll('[data-build-inline]'));
    containers.forEach((c)=>{ c.innerHTML = ""; c.style.display = "none"; });
    if(!buildId || buildId === "none"){ syncCheckboxes(); recomputeProgress(); return; }

    const build = builds[buildId];
    if(!build) return;
    const grouped = {};
    const push = (act, item)=>{ const key = act ? `act${act}` : "misc"; if(!grouped[key]) grouped[key] = []; grouped[key].push(item); };

    (build.checklist||[]).forEach(item=> push(item.act || "misc", { ...item, type: "checklist" }));
    (build.milestones||[]).forEach((item, idx)=> push(item.act || "misc", { ...item, type: "milestone", id: item.id || `bld-${buildId}-ms-${idx+1}`}));

    containers.forEach((container)=>{
      const rows = grouped[container.dataset.buildInline] || [];
      if(!rows.length) return;
      container.style.display = "flex";
      const title = document.createElement("div");
      title.className = "subtle";
      title.textContent = `${build.name || "Build"} steps for this act:`;
      container.appendChild(title);
      rows.forEach((row)=>{
        const label = document.createElement("label");
        label.className = "check";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.dataset.id = row.id;
        label.appendChild(cb);
        const span = document.createElement("span");
        if(row.type === "milestone"){
          const left = row.level ? `<strong>${row.level}</strong>` : "Milestone";
          const area = row.area ? ` – ${row.area}` : "";
          const detail = row.skills ? `: ${row.skills}` : row.gear ? `: ${row.gear}` : "";
          span.innerHTML = `${left}${area}${detail}`;
        }else{
          span.textContent = row.label || "Build step";
        }
        label.appendChild(span);
        container.appendChild(label);
        if(row.note){ const note = document.createElement("div"); note.className = "note"; note.textContent = row.note; container.appendChild(note); }
      });
    });

    syncCheckboxes();
    recomputeProgress();
  }

  function applyBuildFilter(active){
    zones.forEach((z)=>{
      const tags = buildTags(z.innerText);
      const match = !active || tags.includes(active) || tags.includes("all");
      z.classList.toggle("faded", active && !match);
      if(match && active) z.classList.add("highlight"); else z.classList.remove("highlight");
    });
  }

  function speedrunMode(enabled){
    document.body.classList.toggle("speedrun", enabled);
  }

  function nextUnchecked(){
    const next = checkboxes.find(cb => !cb.checked);
    if(next){ next.scrollIntoView({behavior:"smooth",block:"center"}); next.focus(); }
  }

  function exportData(){
    const payload = {
      profile: currentProfile,
      checks: loadChecks(),
      notes: loadNotes()
    };
    const blob = btoa(JSON.stringify(payload));
    navigator.clipboard?.writeText(blob);
    alert("Progress copied to clipboard as JSON blob.");
  }

  function importData(){
    const raw = prompt("Paste exported progress blob:");
    if(!raw) return;
    try{
      const decoded = JSON.parse(atob(raw));
      if(decoded.checks){ localStorage.setItem(storageKey(), JSON.stringify(decoded.checks)); }
      if(decoded.notes){ localStorage.setItem(noteKey(), JSON.stringify(decoded.notes)); }
      initChecks();
      attachNotes();
      alert("Imported!");
    }catch(err){ alert("Invalid import data"); }
  }

  function shareProgress(){
    const payload = {
      profile: currentProfile,
      checks: loadChecks(),
      notes: loadNotes()
    };
    const encoded = btoa(JSON.stringify(payload));
    const url = `${location.origin}${location.pathname}#share=${encoded}`;
    navigator.clipboard?.writeText(url);
    alert("Shareable read-only link copied!");
  }

  function tryLoadShare(){
    const hash = location.hash || "";
    if(hash.startsWith("#share=")){
      try{
        const data = JSON.parse(atob(hash.replace("#share=","")));
        readOnlyShare = true;
        document.body.classList.add("readonly");
        if(data.checks){ localStorage.setItem(storageKey(), JSON.stringify(data.checks)); }
        if(data.notes){ localStorage.setItem(noteKey(), JSON.stringify(data.notes)); }
      }catch(e){ console.warn("Share load failed", e); }
    }
  }

  function initializeProfiles(){
    profileSelect.value = currentProfile;
    profileSelect.addEventListener("change", ()=>{
      currentProfile = profileSelect.value;
      localStorage.setItem(PROFILE_KEY, currentProfile);
      initChecks();
      attachNotes();
      recomputeProgress();
      const savedBuild = localStorage.getItem(buildKey());
      renderBuildOverlay(builds[savedBuild] ? savedBuild : "none");
    });
  }

  function keyboardNav(){
    document.addEventListener("keydown", (e) => {
      if(e.key === "/" && document.activeElement !== q){ e.preventDefault(); q.focus(); }
      else if(e.key === "Escape" && document.activeElement === q){ q.value = ""; q.blur(); filter(); }
      else if(e.key === "n" && !e.metaKey){ nextUnchecked(); }
      else if(e.key === "t" && e.altKey){ speedrunMode(!document.body.classList.contains("speedrun")); }
    });
  }

  function languageInit(){
    const texts = {
      en: { search: "Type to filter (e.g., 'resistance', 'book', 'bench', 'ritual')…" },
      es: { search: "Escribe para filtrar (ej. resistencia, libro, banco, ritual)…" }
    };
    languageSelect.addEventListener("change", ()=>{
      const lang = languageSelect.value;
      q.placeholder = texts[lang]?.search || texts.en.search;
    });
  }

  function initBuildSelector(){
    if(!buildSelect) return;
    const saved = localStorage.getItem(buildKey());
    const choice = builds[saved] ? saved : "none";
    buildSelect.value = choice;
    buildSelect.addEventListener("change", ()=> renderBuildOverlay(buildSelect.value));
    renderBuildOverlay(choice);
  }

  function themePickerInit(){
    if(!themeSelect) return;
    const saved = resolveThemeName(localStorage.getItem(THEME_KEY));
    themeSelect.value = saved;
    themeSelect.addEventListener("change", (e)=> applyTheme(e.target.value));
  }

  function calloutHints(){
    zones.forEach((z)=>{
      const text = z.innerText.toLowerCase();
      const hints = [];
      if(text.includes("outer")) hints.push("🧱 Follow outer wall");
      if(text.includes("opposite")) hints.push("🧭 Opposite entrance");
      if(text.includes("swirl")) hints.push("🌪 Black swirls point the way");
      if(!hints.length) return;
      const c = document.createElement("div");
      c.className = "callout";
      c.innerHTML = hints.map(h=>`<i>${h}</i>`).join(" · ");
      z.querySelector(".zoneHeader")?.appendChild(c);
    });
  }

  function difficultyBadges(){
    zones.forEach((z)=>{
      const diff = (parseInt(z.querySelector(".zoneNum")?.textContent||"1",10)%5)+1;
      const badge = document.createElement("span");
      badge.className = "difficulty";
      badge.textContent = "★".repeat(diff).padEnd(5,"☆");
      z.querySelector(".zoneName")?.appendChild(badge);
    });
  }

  function timelineToggle(){
    const show = document.body.dataset.timeline !== "on";
    document.body.dataset.timeline = show ? "on" : "off";
    document.querySelectorAll(".miniTimeline").forEach(el=> el.style.display = show ? "flex" : "none");
  }

  function hookDashboardFilters(){
    document.querySelectorAll("[data-dash-filter]").forEach(btn=>{
      btn.addEventListener("click", ()=> renderRewards(btn.dataset.dashFilter));
    });
  }

  function initSharingUI(){
    btnShare.addEventListener("click", shareProgress);
  }

  function initModals(){
    btnDashboard.addEventListener("click", ()=>{ renderRewards(); toggleModal(modalDashboard,true); });
    btnShowChangelog.addEventListener("click", ()=> toggleModal(modalChangelog,true));
    document.querySelectorAll("[data-close]").forEach((btn)=>{
      btn.addEventListener("click", ()=>{
        const target = document.getElementById(btn.dataset.close);
        if(target) toggleModal(target,false);
      });
    });
    modalDashboard.addEventListener("click", (e)=>{ if(e.target === modalDashboard) toggleModal(modalDashboard,false); });
    modalChangelog.addEventListener("click", (e)=>{ if(e.target === modalChangelog) toggleModal(modalChangelog,false); });
  }

  function initBottomBar(){
    btnQuickNext.addEventListener("click", nextUnchecked);
    btnTimelineToggle.addEventListener("click", timelineToggle);
    btnBuildToggle.addEventListener("click", ()=>applyBuildFilter("melee"));
    btnDontMissBottom.addEventListener("click", ()=>dontMissMode());
    document.getElementById("toggleMobile").addEventListener("click", ()=>{
      document.querySelector(".bottomBar")?.classList.toggle("hidden");
    });
  }

  function initOtherButtons(){
    btnDontMiss.addEventListener("click", ()=> dontMissMode());
    btnSpeedrun.addEventListener("click", ()=> speedrunMode(!document.body.classList.contains("speedrun")) );
    btnExport.addEventListener("click", exportData);
    btnImport.addEventListener("click", importData);
    btnFork.addEventListener("click", ()=> window.open("https://github.com/", "_blank"));
  }

  function addTooltips(){
    document.querySelectorAll(".tag").forEach(tag=>{
      const t = normalize(tag.textContent);
      if(t.includes("spirit")) tag.title = "Spirit powers skills and abilities";
      if(t.includes("bench")) tag.title = "Bench unlock improves crafting options";
      if(t.includes("book")) tag.title = "Books grant passive points";
      if(t.includes("ascend")) tag.title = "Ascendancy unlocks Trial item";
    });
  }

  tryLoadShare();
  attachNotes();
  initChecks();
  themePickerInit();
  applyTheme();
  initBuildSelector();
  filter();
  createTimeline();
  difficultyBadges();
  calloutHints();
  hookDashboardFilters();
  initModals();
  initBottomBar();
  initOtherButtons();
  initMoreMenu();
  initSharingUI();
  keyboardNav();
  languageInit();
  initializeProfiles();
  addTooltips();

  // Keyboard shortcuts for search and reset
  document.addEventListener("keydown", (e) => {
    if(e.key === "/" && document.activeElement !== q){
      e.preventDefault();
      q.focus();
    }else if(e.key === "Escape"){
      if(document.activeElement === q){
        q.value = "";
        q.blur();
        filter();
      }
    }
  });

  q.addEventListener("input", filter);
  btnExpand.addEventListener("click", expandAll);
  btnCollapse.addEventListener("click", collapseAll);
  btnReset.addEventListener("click", resetAll);
  btnPrint.addEventListener("click", () => window.print());
})();
</script>
</body>
</html>
